<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
	
	var juego = new Phaser.Class({

    Extends: Phaser.Scene,

    initialize:

    function juego ()
    {
        Phaser.Scene.call(this, { key: 'juego' });
    },

    preload: function ()
    {
        this.load.spritesheet('dron', 'assets/sprites/dron.png', {frameWidth: 35, frameHeight:35});
		this.load.spritesheet('target', 'assets/sprites/traget.png', {frameWidth:53, frameHeight: 52, margin:1});
    },

    create: function ()
    {
	
	this.scene.launch('fondo');
	this.scene.launch('HUD');
	this.scene.moveBelow('juego','fondo');
	this.scene.bringToTop('HUD');
	
    var _this = this;
	dummy = this.physics.add.sprite(100, 100, 'target');
	
	player = this.physics.add.sprite(-90, 2070, 'dron');
	player.setOrigin(0.5, 0.5).setDisplaySize(60, 60).setCollideWorldBounds(false);
	this.cameras.main.startFollow(player);
	this.anims.create({
        key: 'dronfly',
        frames: this.anims.generateFrameNumbers('dron', {start:0, end:3}),
        frameRate: 10,
        repeat: -1
    });
	player.anims.play('dronfly');
	
	//mostrar la posicion del cursor
	text = this.add.text(0, 0, 'Posicion mouse', {font: "24px Arial", fill: '#000000'}).setScrollFactor(0);	
	text2 = this.add.text(0, 400, 'Posicion sprite', {font: "24px Arial", fill: '#000000'}).setScrollFactor(0);
	
	//crear un puntero
	target = this.physics.add.sprite(200,200,'target');
	this.anims.create({
        key: 'idleTarget',
        frames: this.anims.generateFrameNumbers('target', {start:0, end:3}),
        frameRate: 10,
        repeat: -1
    });
	target.anims.play('idleTarget');
	
	//mover el puntero con el mouse
	this.input.on('pointermove', function (pointer) {
		target.setPosition(pointer.x + this.cameras.main.scrollX, pointer.y + this.cameras.main.scrollY);
		text.setText('PosX:'+ pointer.x +'\n'+'PosY:' + pointer.y);
    }, this);
	
	this.input.on('pointerdown', function (pointer) {
		dummy.destroy();
		this.physics.moveTo(player, pointer.x+this.cameras.main.scrollX, pointer.y+this.cameras.main.scrollY, 85);
		dummy = this.physics.add.sprite((pointer.x + this.cameras.main.scrollX), (pointer.y + this.cameras.main.scrollY), 'target', 1);
		posx=pointer.x+this.cameras.main.scrollX;
		posy=pointer.y+this.cameras.main.scrollY;
		console.log('muevase hacia X: ' + posx + 'Y: ' + posy);
		moviendose = true;
    }, this);
	
	cursors = this.input.keyboard.createCursorKeys();
	
	
    },
	
	update: function (time, delta)
    {
        const speed = 75;
		const prevVelocity = player.body.velocity.clone();

	// Horizontal movement
		if (cursors.left.isDown) {
			player.body.setVelocityX(-speed);
		} else if (cursors.right.isDown) {
			player.body.setVelocityX(speed);
		}
	// Vertical movement
		if (cursors.up.isDown) {
			player.body.setVelocityY(-speed);
		} else if (cursors.down.isDown) {
			player.body.setVelocityY(speed);
		}
		
		
		if(moviendose){
			if(Phaser.Math.Distance.Between(player.x,player.y,posx,posy) < 5){
				player.body.setVelocity(0);
				moviendose=false;
				console.log('parado');
				dummy.destroy();
			}
		}
		
		
		
		
		text2.setText('Sprite \n' + player.x + '\n' + player.y);
    }

});
	
	var HUD = new Phaser.Class({

    Extends: Phaser.Scene,

    initialize:

    function HUD ()
    {
        Phaser.Scene.call(this, { key: 'HUD' });
    },

    preload: function ()
    {
        this.load.spritesheet('lupas', 'assets/sprites/lupas.png',{frameWidth: 33, frameHeight:33});
    },

    create: function ()
    {
		var _this = this;
		var zip=1;
        zoomin = this.physics.add.sprite(470,420, 'lupas', 0).setInteractive();
		zoomout = this.physics.add.sprite(470,470, 'lupas', 1).setInteractive();
		camara = this.physics.add.sprite(470,360, 'lupas', 2).setInteractive();
		zoomin.setDisplaySize(50,50);
		zoomout.setDisplaySize(50,50);
		camara.setDisplaySize(90,90);
		
		this.anims.create({
        key: 'anicamara',
        frames: this.anims.generateFrameNumbers('lupas', {start:3, end:4}),
        frameRate: 10,
        repeat: -1
		});
		
		zoomin.on('pointerdown', function (pointer) {
		zip=zip*2;
        cam.zoomTo(zip,1500);
		
    }, this);
	
		zoomout.on('pointerdown', function (pointer) {
		zip=zip/2;
        cam.zoomTo(zip,1500);
    });
	
	camara.on('pointerdown', function (pointer) {
		console.log('click');
		if(distp1 < 50){
			console.log('click1');
		}
		if(distp2 < 50){
			console.log('click2');
		}
    });
	
    }

});
	
	//escena fondo
	var fondo = new Phaser.Class({

    Extends: Phaser.Scene,

    initialize:

    function fondo ()
    {
        Phaser.Scene.call(this, { key: 'fondo' });
    },

    preload: function ()
    {
        this.load.image('foto', 'assets/mapaUD.png');
    },

    create: function ()
    {
		var _this = this;
		var visitado = false;
		cam = this.cameras.main;
        fondo = this.add.image(400, 300, 'foto');
		this.cameras.main.startFollow(player);
		
		// We create the graphics object
		pos1 = this.add.graphics({ x: -90, y: 1950 });
		pos2 = this.add.graphics({ x: 515, y: 1195 });
		pos1.fillStyle(0xff0000, 0.7);
		pos1.fillCircle(0, 0, 50);
		pos2.fillCircle(0, 0, 50);
		
		
    },
	
	update: function(time,delta)
	{
	
	distp1 = Phaser.Math.Distance.Between(player.x,player.y,pos1.x,pos1.y);
	distp2 = Phaser.Math.Distance.Between(player.x,player.y,pos2.x,pos2.y);
	
		if(moviendose){
			if(distp1 < 50){
				if(!visitado){
					console.log('Lugar 1');
					camara.anims.play('anicamara');
					visitado = true;
				}
			}
			if(distp1 > 50 && distp2 > 50){
				visitado=false;
				camara.anims.stop('anicamara');
				camara.setFrame(2);
			}
			
			if(distp2 < 50){
				if(!visitado){
					console.log('Lugar 2');
					camara.anims.play('anicamara');
					visitado = true;
				}
			}
		}
	}

});
	
    var config = {
        type: Phaser.AUTO,
		width: 500,
		height: 500,
		transparent: true,
		backgroundColor: 'rgba(09,30,09,0.5)',
		//zoom: 3, // Since we're working with 16x16 pixel tiles, let's scale up the canvas by 3x
		pixelArt: true, // Force the game to scale images up crisply
		physics:{
		default: "arcade",
		arcade:{
			gravity: {y:0}
			}
		},
        scene: [juego, HUD, fondo]
    };

    var game = new Phaser.Game(config);
	let cursors;
	let player;
	let dummy;
	let target;
	let text;
	let text2;
	var distp1,distp2,pos3,pos4;
	var moviendose = true;
	var posx, posy;
	var cam;
	var camara;
	var visitado;

	
	

    </script>

</body>
</html>