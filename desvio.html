<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
		width: 500,
		height: 500,
		transparent: true,
		backgroundColor: 'rgba(09,30,09,0.5)',
		//zoom: 3, // Since we're working with 16x16 pixel tiles, let's scale up the canvas by 3x
		pixelArt: true, // Force the game to scale images up crisply
		physics:{
		default: "arcade",
		arcade:{
			gravity: {y:0}
			}
		},
        scene: {
            preload: preload,
            create: create,
			update: update,
        }
    };

    var game = new Phaser.Game(config);
	let cursors;
	let player;
	let target;
	let text;
	let text2;
	var moviendose = true;
	var posx, posy;

    function preload ()
    {
		this.load.spritesheet('dron', 'assets/sprites/dron.png', {frameWidth: 35, frameHeight:35});
		this.load.spritesheet('target', 'assets/sprites/traget.png', {frameWidth:53, frameHeight: 52, margin:1});
    }

    function create ()
    {
	dummy = this.physics.add.sprite(100, 100, 'target');
	
	player = this.physics.add.sprite(100, 100, 'dron');
	player.setOrigin(0.5, 0.5).setDisplaySize(60, 60).setCollideWorldBounds(false);
	this.cameras.main.startFollow(player);
	this.anims.create({
        key: 'dronfly',
        frames: this.anims.generateFrameNumbers('dron', {start:0, end:3}),
        frameRate: 10,
        repeat: -1
    });
	player.anims.play('dronfly');
	
	//mostrar la posicion del cursor
	text = this.add.text(0, 0, 'Posicion mouse', {font: "24px Arial", fill: '#000000'}).setScrollFactor(0);	
	text2 = this.add.text(0, 400, 'Posicion sprite', {font: "24px Arial", fill: '#000000'}).setScrollFactor(0);
	
	//crear un puntero
	target = this.physics.add.sprite(200,200,'target');
	this.anims.create({
        key: 'idleTarget',
        frames: this.anims.generateFrameNumbers('target', {start:0, end:3}),
        frameRate: 10,
        repeat: -1
    });
	target.anims.play('idleTarget');
	
	//mover el puntero con el mouse
	this.input.on('pointermove', function (pointer) {
		target.setPosition(pointer.x + this.cameras.main.scrollX, pointer.y + this.cameras.main.scrollY);
		text.setText('PosX:'+ pointer.x +'\n'+'PosY:' + pointer.y);
    }, this);
	
	this.input.on('pointerdown', function (pointer) {
		dummy.destroy();
		this.physics.moveTo(player, pointer.x+this.cameras.main.scrollX, pointer.y+this.cameras.main.scrollY, 85);
		dummy = this.physics.add.sprite(pointer.x + this.cameras.main.scrollX, pointer.y + this.cameras.main.scrollY,'target');
		posx=pointer.x+this.cameras.main.scrollX;
		posy=pointer.y+this.cameras.main.scrollY;
		console.log('muevase hacia X: ' + posx + 'Y: ' + posy);
		moviendose = true;
    }, this);
	
	cursors = this.input.keyboard.createCursorKeys();
		
    }
	
	function update(time, delta){
		const speed = 75;
		const prevVelocity = player.body.velocity.clone();

	// Stop any previous movement from the last frame
		//player.body.setVelocity(0);

	// Horizontal movement
		if (cursors.left.isDown) {
			player.body.setVelocityX(-speed);
		} else if (cursors.right.isDown) {
			player.body.setVelocityX(speed);
		}
	// Vertical movement
		if (cursors.up.isDown) {
			player.body.setVelocityY(-speed);
		} else if (cursors.down.isDown) {
			player.body.setVelocityY(speed);
		}
		
		
		if(moviendose){
			if(Phaser.Math.Distance.Between(player.x,player.y,posx,posy) < 5){
				player.body.setVelocity(0);
				moviendose=false;
				console.log('parado');
				dummy.destroy();
			}
		}
		
		
		text2.setText('Sprite \n' + player.x + '\n' + player.y);
	
		
}

    </script>

</body>
</html>