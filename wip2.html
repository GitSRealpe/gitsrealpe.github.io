<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var config = {
        type: Phaser.AUTO,
		width: 600,
		height: 600,
		transparent: true,
		backgroundColor: 'rgba(110,110,255,0.5)',
		//zoom: 3, // Since we're working with 16x16 pixel tiles, let's scale up the canvas by 3x
		pixelArt: true, // Force the game to scale images up crisply
		physics:{
		default: "arcade",
		arcade:{
			gravity: {y:0}
			}
		},
        scene: {
            preload: preload,
            create: create,
			update: update,
        }
    };

    var game = new Phaser.Game(config);
	let cursors;
	let player;
	let target;
	let text;

    function preload ()
    {
		this.load.spritesheet('gamerh', 'assets/sprites/hm_sprites_hall.png', {frameWidth: 32, frameHeight:32});
		this.load.spritesheet('gamerv', 'assets/sprites/hm_sprites_vall.png', {frameWidth: 32, frameHeight:32});
		this.load.spritesheet('target', 'assets/sprites/traget.png', {frameWidth:53, frameHeight: 52, margin:1});
    }

    function create ()
    {
	
	player = this.physics.add.sprite(100, 100, 'gamerh');
	player.setOrigin(0.5, 0.5).setDisplaySize(70, 70).setCollideWorldBounds(false);
	this.cameras.main.startFollow(player);
	
	//mostrar la posicion del cursor
	text = this.add.text(0, 0, '- phaser text-', {font: "32px Arial", fill: '#000000'}).setScrollFactor(0);
	this.input.on('pointermove', function (pointer) {
		text.setText('PosX:'+ pointer.x +'\n'+'PosY:' + pointer.y);
    }, this);
	
	dummy= this.physics.add.sprite(0,0,'target');
	
	//crear un puntero
	target = this.physics.add.sprite(200,200,'target');
	this.anims.create({
        key: 'idleTarget',
        frames: this.anims.generateFrameNumbers('target', {start:0, end:3}),
        frameRate: 10,
        repeat: -1
    });
	target.anims.play('idleTarget');
	//mover el puntero con le mouse
	this.input.on('pointermove', function (pointer) {
		//target.x = pointer.x + this.cameras.main.scrollX;
		//target.y = pointer.y + this.cameras.main.scrollY;
		target.setPosition(pointer.x + this.cameras.main.scrollX, pointer.y + this.cameras.main.scrollY);
    }, this);
	
	this.input.on('pointerdown', function (pointer) {
		text.setText('aloha');
		this.physics.moveTo(player, 0, 0);
    }, this);
	
	this.anims.create({
		key: 'walk-right',
		frames: this.anims.generateFrameNumbers('gamerh', { start: 0, end: 7 }),
		frameRate: 15,
		repeat: -1
	});
	this.anims.create({
		key: 'walk-left',
		frames: this.anims.generateFrameNumbers('gamerh', { start: 8, end: 15 }),
		frameRate: 15,
		repeat: -1
	});
	
	this.anims.create({
		key: 'walk-up',
		frames: this.anims.generateFrameNumbers('gamerv', { start: 0, end: 7 }),
		frameRate: 15,
		repeat: -1
	});
	this.anims.create({
		key: 'walk-down',
		frames: this.anims.generateFrameNumbers('gamerv', { start: 8, end: 15 }),
		frameRate: 15,
		repeat: -1
	});
	
	cursors = this.input.keyboard.createCursorKeys();
		
		
    }
	
	function update(time, delta){
		const speed = 175;
		const prevVelocity = player.body.velocity.clone();

  // Stop any previous movement from the last frame
		player.body.setVelocity(0);

  // Horizontal movement
		if (cursors.left.isDown) {
			player.body.setVelocityX(-speed);
		} else if (cursors.right.isDown) {
			player.body.setVelocityX(speed);
		}

	// Vertical movement
		if (cursors.up.isDown) {
			player.body.setVelocityY(-speed);
		} else if (cursors.down.isDown) {
			player.body.setVelocityY(speed);
		}
		player.body.velocity.normalize().scale(speed);
	//Animaciones	
		if (cursors.right.isDown) {
			player.anims.play("walk-right", true);
		} else if (cursors.left.isDown){
			player.anims.play("walk-left", true);
		} else if (cursors.up.isDown){
			player.anims.play("walk-up", true);
		} else if (cursors.down.isDown){
			player.anims.play("walk-down", true);
		}else {player.anims.stop();}	
		
		
	
	
	
	
	
	
		
}

    </script>

</body>
</html>